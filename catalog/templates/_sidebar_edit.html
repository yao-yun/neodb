{% load static %}
{% load i18n %}
{% load admin_url %}
{% load mastodon %}
{% load oauth_token %}
{% load truncate %}
{% if item %}
  <h5>è¿›é˜¶ç¼–è¾‘é€‰é¡¹</h5>
  {% if item.editable or request.user.is_staff %}
    {% for res in form.instance.external_resources.all %}
      <details>
        <summary>
          {% trans 'æºç½‘ç«™' %}: <a href="{{ res.url }}">{{ res.site_name.label }}</a>
        </summary>
        <div class="grid">
          <form method="post"
                action="{% url 'catalog:refetch' %}"
                onsubmit="return confirm('ç°æœ‰ä¿¡æ¯å¯èƒ½ä¼šè¢«è¦†ç›–ã€‚ç¡®è®¤é‡æ–°è·å–å—ï¼Ÿ');">
            {% csrf_token %}
            <input type="hidden" name="id" value="{{ res.id }}">
            <input type="hidden" name="url" value="{{ res.url }}">
            <input class="secondary" type="submit" value="{% trans 'é‡æ–°è·å–' %}">
          </form>
          {% if request.user.is_staff %}
            <form method="post"
                  action="{% url 'catalog:unlink' %}"
                  onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤å–æ¶ˆå…³è”å—ï¼Ÿ');">
              {% csrf_token %}
              <input type="hidden" name="id" value="{{ res.id }}">
              <input class="contrast" type="submit" value="{% trans 'å–æ¶ˆå…³è”' %}">
            </form>
          {% endif %}
        </div>
      </details>
    {% endfor %}
    {% if item.child_class %}
      <details>
        <summary>{% trans 'æ–°å»ºå­æ¡ç›®' %}</summary>
        <form method="get" action="{% url 'catalog:create' item.child_class %}">
          <input name="parent" type=hidden value="{{ item.uuid }}">
          <input class="contrast" type="submit" value="{{ item.child_class }}">
        </form>
      </details>
    {% endif %}
    <details>
      <summary>{% trans 'åˆ‡æ¢åˆ†ç±»' %}</summary>
      {% if item.class_name == "movie" %}
        <form method="post"
              action="{% url 'catalog:recast' item.url_path item.uuid %}"
              onsubmit="return confirm('ç¡®è®¤åˆ‡æ¢å—ï¼Ÿ');">
          {% csrf_token %}
          <input type="hidden" value="tvshow" name="class">
          <input class="contrast" type="submit" value="{% trans 'æ›´æ”¹ä¸ºå‰§é›†' %}">
        </form>
      {% elif item.class_name == "tvshow" %}
        {% if item.all_seasons %}<i>â›”ï¸ æ¡ç›®ä¸‹å·²æœ‰å­é¡¹</i>{% endif %}
        {% if not item.all_seasons or request.user.is_staff %}
          {% comment %} <form method="post" action="{% url 'catalog:recast' item.url_path item.uuid %}" onsubmit="return confirm('ç¡®è®¤åˆ‡æ¢å—ï¼Ÿ');">
            {% csrf_token %}
            <input type="hidden" value="movie" name="class">
            <input class="contrast" type="submit" value="{% trans 'æ›´æ”¹ä¸ºç”µå½±' %}">
          </form> {% endcomment %}
          <form method="post"
                action="{% url 'catalog:recast' item.url_path item.uuid %}"
                onsubmit="return confirm('ç¡®è®¤åˆ‡æ¢å—ï¼Ÿ');">
            {% csrf_token %}
            <input type="hidden" value="tvseason" name="class">
            <input class="contrast" type="submit" value="{% trans 'æ›´æ”¹ä¸ºå•å­£' %}">
          </form>
        {% endif %}
      {% else %}
        <i>æ­¤ç±»æ¡ç›®æ— æ³•åˆ‡æ¢</i>
      {% endif %}
    </details>
    {% if item.is_deleted and not request.user.is_staff %}
      <i>â›”ï¸ æ¡ç›®å·²è¢«åˆ é™¤</i>
    {% elif item.merged_to_item and not request.user.is_staff %}
      <i>â›”ï¸ æ¡ç›®å·²è¢«åˆå¹¶</i>
    {% elif item.journal_exists and not request.user.is_staff %}
      <i>â›”ï¸ æ¡ç›®å·²è¢«ç”¨æˆ·æ ‡è®°è¿‡</i>
    {% else %}
      {% if item.class_name == "tvseason" or item.class_name == "performanceproduction" %}
        {% if not item.show or request.user.is_superuser %}
          <details>
            <summary>å°†{{ item.type.label }}å…³è”åˆ°ä¸Šä¸€çº§æ¡ç›®</summary>
            <form method="post"
                  action="{% url 'catalog:assign_parent' item.url_path item.uuid %}"
                  onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤å…³è”å—ï¼Ÿ');">
              {% csrf_token %}
              <input type="url"
                     name="parent_item_url"
                     placeholder="ç›®æ ‡æ¡ç›®URL"
                     value="{{ item.show.absolute_url }}"
                     required>
              <br>
              <input class="contrast" type="submit" value="{% trans 'æ›´æ–°å…³è”' %}">
            </form>
          </details>
        {% endif %}
      {% elif item.class_name == "tvshow" %}
        <details>
          <summary>æ¸…ç†å•å­£</summary>
          <form method="post"
                action="{% url 'catalog:remove_unused_seasons' item.url_path item.uuid %}"
                onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤åˆ é™¤å—ï¼Ÿ');">
            {% csrf_token %}
            <input class="contrast" type="submit" value="{% trans 'åˆ é™¤æœªè¢«æ ‡è®°çš„å•å­£' %}">
          </form>
        </details>
      {% endif %}
      <details>
        <summary>{% trans 'åˆå¹¶åˆ°åŒç±»å¦ä¸€æ¡ç›®' %}</summary>
        {% if item.journal_exists %}<i>ğŸš¸ æ¡ç›®å·²è¢«ç”¨æˆ·æ ‡è®°è¿‡</i>{% endif %}
        <form method="post"
              action="{% url 'catalog:merge' item.url_path item.uuid %}"
              onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤åˆå¹¶å—ï¼Ÿ');">
          {% csrf_token %}
          <input type="url"
                 name="new_item_url"
                 placeholder="ç›®æ ‡æ¡ç›®URLï¼Œç•™ç©ºåˆ™å–æ¶ˆç°æœ‰åˆå¹¶"
                 value="{{ item.merged_to_item.absolute_url }}">
          <br>
          <input class="contrast" type="submit" value="{% trans 'åˆå¹¶' %}">
        </form>
        {% for i in item.merged_from_items.all %}
          {% if forloop.first %}
            ä»ä»¥ä¸‹æ¡ç›®åˆå¹¶è€Œæ¥ï¼š
            <ul>
            {% endif %}
            <li>
              <a href="{{ i.url }}?skipcheck=1">{{ i.title }}</a>
            </li>
            {% if forloop.last %}</ul>{% endif %}
        {% endfor %}
      </details>
      <details>
        <summary>{% trans 'åˆ é™¤' %}</summary>
        {% if item.class_name == "tvshow" and item.all_seasons %}
          <i>â›”ï¸ æ¡ç›®ä¸‹æœ‰å­é¡¹</i>
        {% elif item.merged_from_items.all %}
          <i>â›”ï¸ æœ‰å…¶ä»–æ¡ç›®è¢«å¹¶å…¥</i>
        {% else %}
          <form method="post"
                action="{% url 'catalog:delete' item.url_path item.uuid %}"
                onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤åˆ é™¤å—ï¼Ÿ');">
            {% csrf_token %}
            <input class="contrast"
                   type="submit"
                   {% if item.is_deleted or item.merged_to_item %}disabled{% endif %}
                   value="{% trans 'åˆ é™¤' %}">
          </form>
        {% endif %}
      </details>
    {% endif %}
  {% endif %}
{% endif %}
