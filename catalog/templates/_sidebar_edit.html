{% load static %}
{% load i18n %}
{% load admin_url %}
{% load mastodon %}
{% load oauth_token %}
{% load truncate %}
<h5>è¿›é˜¶ç¼–è¾‘é€‰é¡¹</h5>
{% if item %}
  {% if item.editable or request.user.is_staff %}
    {% for res in form.instance.external_resources.all %}
      <details>
        <summary>
          {% trans 'æºç½‘ç«™' %}: <a href="{{ res.url }}">{{ res.site_name.label }}</a>
        </summary>
        <div class="grid">
          <form method="post" action="{% url 'catalog:refetch' %}">
            {% csrf_token %}
            <input type="hidden" name="id" value="{{ res.id }}">
            <input type="hidden" name="url" value="{{ res.url }}">
            <input class="secondary" type="submit" value="{% trans 'é‡æ–°æŠ“å–' %}">
          </form>
          {% if request.user.is_staff %}
            <form method="post" action="{% url 'catalog:unlink' %}">
              {% csrf_token %}
              <input type="hidden" name="id" value="{{ res.id }}">
              <input class="contrast" type="submit" value="{% trans 'å–æ¶ˆå…³è”' %}">
            </form>
          {% endif %}
        </div>
      </details>
    {% endfor %}
    {% if item.class_name == "movie" or item.class_name == "tvshow" %}
      <details>
        <summary>{% trans 'åˆ‡æ¢åˆ†ç±»' %}</summary>
        <form method="post"
              action="{% url 'catalog:recast' item.url_path item.uuid %}"
              onsubmit="return confirm('ç¡®è®¤åˆ‡æ¢å—ï¼Ÿ');">
          {% csrf_token %}
          {% if item.class_name == "movie" %}
            <input type="hidden" value="tvshow" name="class">
            <input class="contrast" type="submit" value="{% trans 'æ›´æ”¹ä¸ºå‰§é›†' %}">
          {% endif %}
          {% if item.class_name == "tvshow" %}
            {% if item.all_seasons %}
              <i>â›”ï¸ æ¡ç›®ä¸‹æœ‰å­é¡¹</i>
            {% else %}
              <input type="hidden" value="movie" name="class">
              <input class="contrast" type="submit" value="{% trans 'æ›´æ”¹ä¸ºç”µå½±' %}">
            {% endif %}
          {% endif %}
        </form>
      </details>
    {% endif %}
    {% if item.class_name == "tvseason" %}
      {% if not item.show or request.user.is_staff %}
        <details>
          <summary>{% trans 'å°†æœ¬å­£å…³è”åˆ°ç”µè§†å‰§' %}</summary>
          <form method="post"
                action="{% url 'catalog:assign_parent' item.url_path item.uuid %}"
                onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤å…³è”å—ï¼Ÿ');">
            {% csrf_token %}
            <input type="url"
                   name="parent_item_url"
                   placeholder="ç›®æ ‡æ¡ç›®URL"
                   value="{{ item.show.absolute_url }}"
                   required>
            <br>
            <input class="contrast" type="submit" value="{% trans 'æäº¤' %}">
          </form>
        </details>
      {% endif %}
    {% endif %}
    {% if item.is_deleted and not request.user.is_staff %}
      <i>â›”ï¸ æ¡ç›®å·²è¢«åˆ é™¤</i>
    {% elif item.merged_to_item and not request.user.is_staff %}
      <i>â›”ï¸ æ¡ç›®å·²è¢«åˆå¹¶</i>
    {% elif not item.journal_exist and not request.user.is_staff %}
      <i>â›”ï¸ æ¡ç›®å·²è¢«ç”¨æˆ·æ ‡è®°è¿‡</i>
    {% else %}
      <details>
        <summary>{% trans 'åˆå¹¶åˆ°å¦ä¸€æ¡ç›®' %}</summary>
        {% if item.journal_exist %}<i>ğŸš¸ æ¡ç›®å·²è¢«ç”¨æˆ·æ ‡è®°è¿‡</i>{% endif %}
        <form method="post"
              action="{% url 'catalog:merge' item.url_path item.uuid %}"
              onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤åˆå¹¶å—ï¼Ÿ');">
          {% csrf_token %}
          <input type="url"
                 name="new_item_url"
                 placeholder="ç›®æ ‡æ¡ç›®URLï¼Œç•™ç©ºåˆ™å–æ¶ˆåˆå¹¶"
                 value="{{ item.merged_to_item.absolute_url }}">
          <br>
          <input class="contrast" type="submit" value="{% trans 'æäº¤' %}">
        </form>
        {% for i in item.merged_from_items.all %}
          {% if forloop.first %}
            ä»ä»¥ä¸‹æ¡ç›®åˆå¹¶è€Œæ¥ï¼š
            <ul>
            {% endif %}
            <li>
              <a href="{{ i.url }}?skipcheck=1">{{ i.title }}</a>
            </li>
            {% if forloop.last %}</ul>{% endif %}
        {% endfor %}
      </details>
      <details>
        <summary>{% trans 'åˆ é™¤' %}</summary>
        {% if item.class_name == "tvshow" and item.all_seasons %}
          <i>â›”ï¸ æ¡ç›®ä¸‹æœ‰å­é¡¹</i>
        {% elif item.merged_from_items.all %}
          <i>â›”ï¸ æœ‰å…¶ä»–æ¡ç›®è¢«å¹¶å…¥</i>
        {% else %}
          <form method="post"
                action="{% url 'catalog:delete' item.url_path item.uuid %}"
                onsubmit="return confirm('æœ¬æ“ä½œä¸å¯æ’¤é”€ã€‚ç¡®è®¤åˆ é™¤å—ï¼Ÿ');">
            {% csrf_token %}
            <input class="contrast"
                   type="submit"
                   {% if item.is_deleted or item.merged_to_item %}disabled{% endif %}
                   value="{% trans 'æäº¤' %}">
          </form>
        {% endif %}
      </details>
    {% endif %}
  {% endif %}
{% endif %}
