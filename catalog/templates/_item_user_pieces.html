{% load user_actions %}
<section>
  <h5>
    我的标签
    {% if not mark.tags %}
      <small>
        <a href="#"
           hx-get="{% url 'journal:mark' item.uuid %}"
           class="item-mark-icon"
           hx-target="body"
           hx-swap="beforeend">
          <i class="fa-regular fa-square-plus"></i>
        </a>
      </small>
    {% endif %}
  </h5>
  <span class="action">
    <span>
      <a href="#"
         hx-get="{% url 'journal:mark' item.uuid %}"
         hx-target="body"
         hx-swap="beforeend"><i class="fa-solid fa-pen-to-square"></i></a>
    </span>
  </span>
  <div class="tag-list">
    {% for tag in mark.tags %}
      <span>
        <a href="{% url 'journal:user_tag_member_list' request.user.mastodon_username tag %}">{{ tag }}</a>
      </span>
    {% endfor %}
  </div>
</section>
<section>
  <h5>
    我的短评
    {% if not mark.comment %}
      <small>
        <a href="#"
           hx-get="{% url 'journal:mark' item.uuid %}"
           class="item-mark-icon"
           hx-target="body"
           hx-swap="beforeend">
          <i class="fa-regular fa-square-plus"></i>
        </a>
      </small>
    {% endif %}
  </h5>
  {% if mark.comment %}
    <span class="action">
      <span>
        <a href="#"
           hx-get="{% url 'journal:mark' item.uuid %}"
           hx-target="body"
           hx-swap="beforeend"><i class="fa-solid fa-pen-to-square"></i></a>
      </span>
      <span>
        {% liked_piece mark.comment as liked %}
        {% include 'like_stats.html' with liked=liked piece=mark.comment %}
      </span>
      <span>
        <a target="_blank"
           rel="noopener"
           {% if mark.comment.metadata.shared_link %} href="{{ mark.comment.metadata.shared_link }}" title="打开联邦网络分享链接" {% else %} class="disabled" {% endif %}><i class="fa-solid {% if mark.comment.visibility > 0 %} fa-lock {% else %} fa-globe {% endif %}"></i></a>
      </span>
      {% comment %} <span class="timestamp">{{ mark.comment.created_time|date }}</span> {% endcomment %}
    </span>
    <p>{{ mark.comment.html|safe }}</p>
  {% endif %}
  <script>window.cil=[];</script>
  {% for comment in child_item_comments %}
    <script>window.cil.push('{{ comment.item.uuid }}');</script>
    <span class="action">
      <span>
        <a href="#"
           hx-get="{% url 'journal:comment' comment.item.uuid %}"
           hx-target="body"
           hx-swap="beforeend"><i class="fa-solid fa-pen-to-square"></i></a>
      </span>
      <span>
        {% liked_piece comment as liked %}
        {% include 'like_stats.html' with liked=liked piece=comment %}
      </span>
      <span>
        <a target="_blank"
           rel="noopener"
           {% if comment.metadata.shared_link %} href="{{ comment.metadata.shared_link }}" title="打开联邦网络分享链接" {% else %} class="disabled" {% endif %}><i class="fa-solid {% if comment.visibility > 0 %} fa-lock {% else %} fa-globe {% endif %}"></i></a>
      </span>
      {% comment %} <span class="timestamp">{{ comment.created_time|date }}</span> {% endcomment %}
    </span>
    <p>
      评<a href="{{ comment.item.url }}">{{ comment.item.title }}</a>: {{ comment.html|safe }}
    </p>
  {% endfor %}
</section>
<section>
  <h5>
    我的评论
    {% if not review %}
      <small>
        <a href="{% url 'journal:review_create' item.uuid %}"
           class="item-mark-icon">
          <i class="fa-regular fa-square-plus"></i>
        </a>
      </small>
    {% endif %}
  </h5>
  {% if review %}
    <span class="action">
      <span>
        <a href="{% url 'journal:review_edit' item.uuid review.uuid %}"
           class="item-mark-icon">
          <i class="fa-solid fa-pen-to-square"></i>
        </a>
      </span>
      <span>
        {% liked_piece mark.review as liked %}
        {% include 'like_stats.html' with liked=liked piece=mark.review %}
      </span>
      <span>
        <a target="_blank"
           rel="noopener"
           {% if mark.review.metadata.shared_link %} href="{{ mark.review.metadata.shared_link }}" title="打���联邦网���分享链接" {% else %} class="disabled" {% endif %}><i class="fa-solid {% if mark.review.visibility > 0 %} fa-lock {% else %} fa-globe {% endif %}"></i></a>
      </span>
      <span class="timestamp">{{ mark.review.created_time|date }}</span>
    </span>
    <p>
      <a href="{% url 'journal:review_retrieve' review.uuid %}">{{ review.title }}</a>
    </p>
  {% else %}
    <!-- <span class="empty">暂无</span> -->
  {% endif %}
</section>
<section>
  <h5>
    我的收藏单
    <small>
      <a href="#"
         hx-get="{% url 'journal:add_to_collection' item.uuid %}"
         class="edit"
         hx-target="body"
         hx-swap="beforeend">
        <i class="fa-regular fa-square-plus"></i>
      </a>
    </small>
  </h5>
  <div>
    {% for c in my_collections %}
      <p>
        <a href="{{ c.url }}">{{ c.title }}</a>
        {% if c.visibility > 0 %}<i class="fa-solid fa-lock"></i>{% endif %}
      </p>
    {% empty %}
      <!-- <span class="empty">暂无</span> -->
    {% endfor %}
  </div>
</section>
<!--
    <section>
      <h5>标记历史</h5>
      <div>
        {% for log in mark.logs %}{{ log.timestamp|date }} {{ log.action_label }}<br>{% endfor %}
      </div>
    </section>
    -->
